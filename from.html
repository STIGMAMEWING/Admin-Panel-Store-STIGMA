<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Formulir Pembelian</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* tambahan kecil agar tombol copy terlihat */
    .bank-info { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.04); padding: 10px; border-radius: 8px; }
    .copy-btn { background: #111827; border: 1px solid rgba(255,255,255,0.06); padding: 6px 10px; border-radius: 6px; cursor: pointer; }
    .copy-success { color: #34d399; font-weight: 600; font-size: 0.9rem; margin-left: 8px; }
  </style>
</head>
<body class="bg-gradient-to-br from-gray-900 to-black text-white min-h-screen flex items-center justify-center">

  <div class="bg-gray-800/80 p-6 rounded-xl shadow-lg w-full max-w-md">
    <h2 class="text-xl font-bold mb-4">ðŸ’³ Formulir Pembelian</h2>
    <p id="produkTerpilih" class="text-center text-yellow-400 mb-4"></p>

    <p class="text-center text-red-400 font-semibold mb-4">Silahkan ditransfer terlebih dahulu</p>

    <form id="paymentForm" class="space-y-3">
      <input type="text" id="name" placeholder="Nama Anda"
        class="w-full px-3 py-2 rounded-lg bg-gray-700 focus:outline-none" required>

      <input type="email" id="email" placeholder="Email Anda"
        class="w-full px-3 py-2 rounded-lg bg-gray-700 focus:outline-none" required>

      <label class="block text-sm text-gray-300">Pilih Bank / E-Wallet / QRIS:</label>
      <select id="bank" class="w-full px-3 py-2 rounded-lg bg-gray-700 focus:outline-none" required>
        <option value="DANA">DANA</option>
        <option value="Seabank">Seabank</option>
        <option value="BCA">BCA</option>
        <option value="QRIS">QRIS</option>
      </select>

      <!-- Area menampilkan detail rekening / qris -->
      <div id="bankDetails" class="mt-2 bank-info">
        <!-- konten akan diisi oleh JS -->
      </div>

      <input type="number" id="jumlah" placeholder="Jumlah Deposit (IDR)"
        class="w-full px-3 py-2 rounded-lg bg-gray-700 focus:outline-none" required>

      <textarea id="keterangan" placeholder="Keterangan (opsional)"
        class="w-full px-3 py-2 rounded-lg bg-gray-700 focus:outline-none"></textarea>

      <label class="block text-sm text-gray-300">Upload Bukti Pembayaran:</label>
      <input type="file" id="bukti" accept="image/*"
        class="w-full px-3 py-2 rounded-lg bg-gray-700 focus:outline-none" required>

      <button type="submit"
        class="w-full bg-yellow-500 hover:bg-yellow-600 text-black py-2 rounded-lg font-semibold">Kirim</button>
    </form>

    <div id="result" class="hidden mt-4 text-center">
      <h3 class="text-lg font-semibold mb-2 text-green-400">âœ… Data berhasil dikirim!</h3>
      <p class="mb-2 text-sm text-gray-300">Silakan hubungi admin melalui sosial media untuk konfirmasi:</p>
      <div class="flex gap-3 justify-center">
        <a href="https://wa.me/6285210441979" target="_blank"
           class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg">WhatsApp</a>
        <a href="https://discord.gg/DMKxAh8x3j" target="_blank"
           class="bg-indigo-600 hover:bg-indigo-700 px-4 py-2 rounded-lg">Discord</a>
        <a href="https://www.instagram.com/aldi_5301?igsh=NXhkeWp5bXRtM2Fy" target="_blank"
           class="bg-pink-600 hover:bg-pink-700 px-4 py-2 rounded-lg">Instagram</a>
        <a href="https://www.facebook.com/share/1GogBFFcut/" target="_blank"
           class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg">Facebook</a>
      </div>
    </div>
  </div>

<script>
/*
  Versi final:
  - Tidak ada backend / localhost.
  - Semua dikirim ke Discord Webhook (attachment + embed).
  - Menampilkan nomor rekening / detail bank yang bisa disalin.
  - QRIS ditampilkan saat pilih QRIS.
  - Input jumlah bisa diisi manual oleh user.
*/

/* === Konfigurasi bank (ubah sesuai kebutuhan) === */
const BANKS = {
  DANA: {
    label: "DANA",
    account: "082123302182",
    owner: "Aldi Juli Saputra",
    note: "DANA"
  },
  Seabank: {
    label: "Seabank",
    account: "901881696550",
    owner: "Aldi Juli Saputra",
    note: "Seabank"
  },
  BCA: {
    label: "BCA",
    account: "4142233766",
    owner: "Aldi Juli Saputra",
    note: "BCA a/n Aldi Juli Saputra"
  },
  QRIS: {
    label: "QRIS",
    image: "https://i.ibb.co/B5V0W1dL/QrisAldi.jpg",
    note: "Scan QRIS untuk membayar"
  }
};

/* === Webhook (sudah dari Anda sebelumnya) === */
const WEBHOOK_URL = "https://discord.com/api/webhooks/1416650188763959336/LzgKpEeYPI9F4szWAxgaVQlnQcvQCMQLigbkeIn4NpRdUXP_w2ePMCWYKth-3ZpjB99o";

/* elemen */
const bankSelect = document.getElementById("bank");
const bankDetails = document.getElementById("bankDetails");
const qrisDiv = document.getElementById("qrisDiv"); // tidak dipakai tapi dibiarkan
const urlParams = new URLSearchParams(window.location.search);
const namaProduk = urlParams.get('produk');
const hargaProduk = urlParams.get('harga');

if (namaProduk) {
  document.getElementById("produkTerpilih").innerText = `Anda akan membeli: ${namaProduk}`;
}
if (hargaProduk) {
  document.getElementById("jumlah").value = hargaProduk;
}

/* render detail bank sesuai pilihan */
function renderBankDetails(key) {
  const info = BANKS[key];
  if (!info) {
    bankDetails.innerHTML = "";
    return;
  }

  if (key === "QRIS") {
    bankDetails.innerHTML = `
      <div class="text-center">
        <img src="${info.image}" alt="QRIS" class="mx-auto mb-2 rounded-lg" style="max-width:200px;">
        <div class="text-sm text-gray-300">${info.note}</div>
        <div class="mt-2">
          <button class="copy-btn" data-copy="${info.image}" onclick="copyText(event)">Copy QR Image URL</button>
          <span class="copy-success" id="copyFeedback" style="display:none;">Copied!</span>
        </div>
      </div>
    `;
  } else {
    // tampilkan nomor rekening + nama pemilik + tombol copy
    bankDetails.innerHTML = `
      <div class="flex items-center justify-between">
        <div>
          <div class="text-sm text-gray-300">${info.label}</div>
          <div style="font-weight:700; font-size:1.05rem;">${info.account}</div>
          <div class="text-xs text-gray-400">${info.owner}</div>
        </div>
        <div style="text-align:right">
          <button class="copy-btn" data-copy="${info.account}" onclick="copyText(event)">Copy Nomor</button>
          <div style="height:6px"></div>
          <button class="copy-btn" data-copy="${info.owner}" onclick="copyText(event)">Copy Pemilik</button>
          <div class="copy-success" id="copyFeedback" style="display:none;">Copied!</div>
        </div>
      </div>
    `;
  }
}

/* copy helper dengan fallback */
async function copyText(e) {
  const btn = e.currentTarget;
  const txt = btn.getAttribute("data-copy");
  if (!txt) return;
  try {
    if (navigator.clipboard && window.isSecureContext) {
      await navigator.clipboard.writeText(txt);
    } else {
      // fallback older browsers
      const ta = document.createElement("textarea");
      ta.value = txt;
      ta.style.position = "fixed";
      ta.style.left = "-9999px";
      document.body.appendChild(ta);
      ta.select();
      document.execCommand("copy");
      document.body.removeChild(ta);
    }
    // feedback kecil
    const fb = btn.parentElement.querySelector("#copyFeedback");
    if (fb) {
      fb.style.display = "inline";
      fb.textContent = "Copied!";
      setTimeout(()=> fb.style.display = "none", 1800);
    } else {
      // global feedback if not inside
      const global = document.createElement("div");
      global.textContent = "Copied!";
      global.style.position = "fixed";
      global.style.right = "20px";
      global.style.bottom = "20px";
      global.style.background = "#064e3b";
      global.style.padding = "8px 12px";
      global.style.borderRadius = "8px";
      document.body.appendChild(global);
      setTimeout(()=> document.body.removeChild(global), 1400);
    }
  } catch (err) {
    alert("Gagal menyalin: " + err);
  }
}

/* initial render */
renderBankDetails(bankSelect.value);

/* update saat ganti bank */
bankSelect.addEventListener("change", (e) => {
  renderBankDetails(e.target.value);
});

/* submit form -> kirim ke webhook (attachment + embed) */
document.getElementById("paymentForm").addEventListener("submit", function(e) {
  e.preventDefault();

  const bukti = document.getElementById("bukti").files[0];
  if (!bukti) {
    alert("Harap upload bukti pembayaran!");
    return;
  }

  const name = document.getElementById("name").value.trim();
  const email = document.getElementById("email").value.trim();
  const bank = document.getElementById("bank").value;
  const jumlah = document.getElementById("jumlah").value.trim();
  const keterangan = document.getElementById("keterangan").value.trim() || "-";

  // siapkan FormData -> file + payload_json (embed)
  const formData = new FormData();
  formData.append("file", bukti);

  const embedPayload = {
    embeds: [{
      title: `ðŸ›ï¸ Transaksi Baru: ${namaProduk || "Produk Tidak Diketahui"}`,
      description: "Ada pesanan baru yang masuk!",
      color: 3447003,
      fields: [
        { name: "Nama Pembeli", value: name || "-", inline: true },
        { name: "Email", value: email || "-", inline: true },
        { name: "Produk", value: namaProduk || "-", inline: false },
        { name: "Jumlah Pembayaran", value: `Rp ${jumlah || "-"}`, inline: true },
        { name: "Metode Pembayaran", value: bank || "-", inline: true },
        { name: "Keterangan", value: keterangan, inline: false }
      ],
      timestamp: new Date().toISOString()
    }]
  };

  formData.append("payload_json", JSON.stringify(embedPayload));

  // kirim ke Discord
  fetch(WEBHOOK_URL, {
    method: "POST",
    body: formData
  })
  .then(response => {
    if (!response.ok) throw new Error("Gagal mengirim notifikasi ke Discord.");
    // tampilkan hasil sukses
    document.getElementById("paymentForm").classList.add("hidden");
    document.getElementById("result").classList.remove("hidden");
    // simpan terakhir di localstorage (opsional)
    let transactions = JSON.parse(localStorage.getItem("transactions")) || [];
    transactions.push({
      nama: name,
      email: email,
      produk: namaProduk || "-",
      harga: jumlah || "-",
      bank: bank,
      keterangan: keterangan,
      tanggal: new Date().toLocaleString()
    });
    localStorage.setItem("transactions", JSON.stringify(transactions));
  })
  .catch(err => {
    console.error("Kesalahan:", err);
    alert("Terjadi kesalahan saat mengirim notifikasi. Coba ulangi.");
  });
});
</script>
</body>
</html>
